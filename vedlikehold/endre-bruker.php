<?php /** * ENDRE INFORMASJONEN TIL BRUKERENE * ENDRE BRUKER NAVN * ENDRE MAIL * ENDRE POSISJON * ENDRE OM MAN ER ADMIN ELLER IKKE	 * * PHP version 5 * * LICENSE: This source file is subject to version 3.01 of the PHP license * that is available through the world-wide-web at the following URI: * http://www.php.net/license/3_01.txt.  If you did not receive a copy of * the PHP License and are unable to obtain it through the web, please * send a note to license@php.net so we can mail you a copy immediately. * * @author		Original Author <andersborglarsen@gmail.com> * @author		Original Author <haavard@ringshaug.net> * @author		Original Author <oyvind.gautestad@gmail.com> * @author		Original Author <linda.fermann@gmail.com> * @copyright 	2013-2018 * @license		http://www.php.net/license/3_01.txt * @link		http://student.hive.no/web10007/1 * */$title = 'Endre Bruker - roomEdit';include '../includes/headerVedlikehold.php';		// INKLUDERER HEADERcheckLogin();										// SJEKKER AT MAN ER LOGGET INNcheckAdmin();										// SJEKKER OM EN BRUKER HAR ADMIN STATUS?><h1>Endre bruker</h1><?php /****************************** Endre Bruker ****************************************/$modifySubmit=$_POST["modifySubmit"];				// HENTER INN EN INPUT KNAPP FRA SKJEMAET$userId = $_POST["userId"];							// LAGRER BRUKERID FRA SKJEMAETconnect();											// KOBLER TIL DATABASEN$sql= "CALL showByUserId('$userId');";				// SQL SPØRRINGEN $result = mysql_query($sql) or die ("ikke mulig å hente Bruker fra  fra databasen");	//RETURNERER FEILMELDING HVIS SPØRRINGEN FEILER$row=mysql_fetch_array($result);					// HENTER ARY TAR DET UT I RADER$userId = $row[0];									// LAGRER DATA I EN LOKAL VARIABEL FRA EN RAD I SQL ARRAYET$username =$row[1];									// LAGRER DATA I EN LOKAL VARIABEL FRA EN RAD I SQL ARRAYET$email =$row[2];										// LAGRER DATA I EN LOKAL VARIABEL FRA EN RAD I SQL ARRAYET$passord=$row[3];									// LAGRER DATA I EN LOKAL VARIABEL FRA EN RAD I SQL ARRAYET$position_Id =$row[4];								// LAGRER DATA I EN LOKAL VARIABEL FRA EN RAD I SQL ARRAYET$admin=$row[5];										// LAGRER DATA I EN LOKAL VARIABEL FRA EN RAD I SQL ARRAYET$ref_user=$row[6];									// LAGRER DATA I EN LOKAL VARIABEL FRA EN RAD I SQL ARRAYETif($position_Id==1) {																//GIR POSISJONEN MER LESBARE NAVN	$userGroup = 'Ansatt';} elseif ($position_Id==2) {	$userGroup = 'Student';} else {	$userGroup = 'tom';}if($admin==1) {																//GIR ADMINRETTIGHETER MER LESBARE NAVN	$adminSetting = 'JA';} elseif ($admin==0) {	$adminSetting = 'NEI';} else {	$adminSetting = 'tom';}disconnect();										// KOBLER FRA DATABASENecho "<fieldset>";echo "  <form class='' name='updateuser' action='' method='post'>";echo "	<input type='hidden' name='userId' value='$userId'>";echo "	<input type='hidden' name='ref_user' value='$ref_user'>";echo "	<p>Brukerreferanse: $ref_user</p>";echo "	<p>Bruker id: $userId</p>";echo "	<p>Registrert brukergruppe: $userGroup</p>";echo "	<p>Registrert som admin: $adminSetting</p>";echo "  <p> Brukernavn kan kun bestå av små eller store bokstaver (A-Z) og tall (0-9). Fra 3-30 karakterer. </p>";echo "	<label>Brukernavn</label>  <input type='text' name='username' id='username' value='$username' pattern='[A-Za-z0-9]{3,30}' required><br>";echo "	<label>E-post</label>  <input type='text' name='email' id='email' value='$email' required>";echo "	<label class='clearfloat'>Student </label>  <input type='radio' name='position_Id' value='2' "; if($position_Id == 2){ echo "checked";}  echo">";echo "	<label>Ansatt </label>  <input type='radio' name='position_Id' value='1' "; if($position_Id == 1){ echo "checked";}  echo">";echo "	 ||   ";echo "	<label class='clearfloat'>Administrator rettigheter:</label> Nei<input type='radio' name='admin' value='0' "; if($admin == 0){ echo "checked";}  echo">												Ja <input type='radio' name='admin' value='1' "; if($admin == 1){ echo "checked";}  echo"><br>";		echo "  <input type='hidden' name='oldUsername' id='oldUsername' value='$username'> ";echo "	<input type='submit' value='Lagre endringer' name='regUpdate'>";echo "</form>";echo "</fieldset>";echo ("		<form method='post' action='vis-brukere.php'>		<input type='submit' value='Avbryt' id='back' name='back'>		</form>		");																					//AVBRYTER ENDRING OG DIRIGERER TILBAKE$regUpdate = $_POST["regUpdate"];					//HENTER INN SUBMITKNAPPEN if ($regUpdate) {									// LYTTER TIL SUBMITKNAPPEN	$userId = $_POST["userId"];						// LAGRER USERID VARIABEL I SKJEMAET	$username = $_POST["username"];					// LAGRER USERNAME VARIABEL  I SKJEMAT	$email = $_POST["email"];							// LAGRER MAIL VARIABLE I SKJEMAET	$passord=cryptPassword($_POST["passord"]);		// LAGRER PASSORD VARIABEL I SKJEMA	$position_Id = $_POST["position_Id"];			// LAGRER POSISJONS ID VARIABEL I SKJEMA	$admin=$_POST["admin"];							// LAGRER ADMIN VARIABEL I SKJEMA	$ref_user = $_POST["ref_user"];					// LAGRER USERREF VARIABEL I SKJEMA 	$oldUsername = $_POST["oldUsername"];			// LAGRER GAMMELT BRUKERNAVN VARIABEL I SKJEMA	if (validatorChangeUser($email, $username)) {		if ( strcmp($oldUsername,$username) != 0 ) {			connect();											//kobler til databasen			$sqlSetning="SELECT username FROM user WHERE username='$username';";	//sjekker om brukernavn finnes fra før			$sqlResultat=mysql_query($sqlSetning);			$antallRader=mysql_num_rows($sqlResultat);			disconnect();					if($antallRader !==0){								//bruker må velge annet brukernavn dersom det finnes fra før				print("<script>alert('Brukernavn ".$brukernavn."finnes fra før')</script>");			} else {				connect();										// KOBLER TIL DATABASE				$sql="	UPDATE User SET				Username='$username',				Mail='$email',				Position_Id='$position_Id',admin='$admin'				WHERE UserId='$userId';";						//SQL SPØRRING SOM OPPDARER BRUKER				$result=mysql_query($sql) or die ("<script>alert('ikke mulig å oppdatere Bruker i databasen')</script>");	//LAGRER SVARET FRA SQL SPØRRINGEN				print("<script>alert('Brukeren med brukernavn $username er oppdatert.'); window.location = 'vis-brukere.php';</script>"); // BEKREFTELSE TIL BRUKEREN AT DATAENE ER LAGRET				disconnect();			}		} else {			connect();										// KOBLER TIL DATABASE			$sql="	UPDATE User SET 																	Username='$username', 			Mail='$email', 			Position_Id='$position_Id',			admin='$admin'			WHERE 			UserId='$userId';";						//SQL SPØRRING SOM OPPDARER BRUKER			$result=mysql_query($sql) or die ("<script>alert('ikke mulig å oppdatere Bruker i databasen')</script>");	//LAGRER SVARET FRA SQL SPØRRINGEN				print("<script>alert('Brukeren med brukernavn $username er oppdatert.'); window.location = 'vis-brukere.php';</script>"); // BEKREFTELSE TIL BRUKEREN AT DATAENE ER LAGRET						disconnect();		}									// KOBLER FRA DATABASEN	}}include '../includes/footerVedlikehold.php';		// INKLUDERER FOOTER?>