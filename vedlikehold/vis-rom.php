<?php /** * Vise alle rom i løsningen * * PHP version 5 * * LICENSE: This source file is subject to version 3.01 of the PHP license * that is available through the world-wide-web at the following URI: * http://www.php.net/license/3_01.txt.  If you did not receive a copy of * the PHP License and are unable to obtain it through the web, please * send a note to license@php.net so we can mail you a copy immediately. * * @author		Original Author <andersborglarsen@gmail.com> * @author		Original Author <haavard@ringshaug.net> * @author		Original Author <oyvind.gautestad@gmail.com> * @author		Original Author <linda.fermann@gmail.com> * @copyright 	2013-2018 * @license		http://www.php.net/license/3_01.txt * @link		http://student.hive.no/web10007/1 * */$title = 'Vis rom - roomEdit';include '../includes/headerVedlikehold.php';	// INKLUDERER HEADERcheckLogin();									// SJEKKER OM BRUKEREN ER LOGGET INNcheckAdmin();											//SJEKKER OM EN BRUKER HAR ADMIN STATUS?><h1>Vis alle rom i løsningen</h1> <fieldset>	<legend>Filtrering</legend>	<form class="" name="filter_room" id="filter_room" action="" method="post">		<label>Blokk: </label> <select name="block" id="block">			<option value="">Alle</option>			<?php 			$block = array();																		// LAGER ET ARRAY FOR BLOKKENE			connect();																				// KOBLER TIL DATABASE			$sql="SELECT SUBSTRING(Name,1,1) as Navn FROM room GROUP BY Navn HAVING COUNT(*);"; 	// HENTER UT BLOKKER FRA DATABASEN			$result=mysql_query($sql) or die ("ikke mulig å hente navn fra databasen");				// LAGRER RESULTATET FRA DATABASEN			$blockLength=mysql_num_rows($result);													// VARIABEL SOM SIER HVOR LANG BLOKK ARRAYET ER			disconnect();																			// KOBLER FRA DATABASEN			for($i=0;$i<$blockLength;$i++) {														// FOR LØKKE SOM GÅR LIKE MANGE GANGER SOM BLOKK TABELLEN HAR I LENGDE				$rad=mysql_fetch_array($result);													// LAGER VARIABEL SOM INNEHOLDER HELE ARRAYET				$block[$i] = $rad[0];																// KOPIERER OVER ALT FRA SQL ARRAYET TIL TIME ARRAYET				echo "<option value='$rad[0]'>$rad[0]</option>";									// RETURNERER DEN SPESIFIKKE KOLONNEN FRA SQL ARRAYET			}			?>		</select> <label>Etasje: </label> <select name="floor" id="floor">			<option value="">Alle</option>			<?php 			$floor = array();																		// LAGER ET ARRAY FOR ETASJE			connect();																				// KOBLER TIL DATABASE			$sql="SELECT SUBSTRING(Name,2,1) as Navn FROM room GROUP BY Navn  HAVING COUNT(*);"; 	// HENTER UT ETASJE FRA DATABASEN			$result=mysql_query($sql) or die ("ikke mulig å hente navn fra databasen");				// LAGRER RESULTATET FRA DATABASEN			$floorLength=mysql_num_rows($result);													// VARIABEL SOM SIER HVOR LANG ETASJE ARRAYET ER			disconnect();																			// KOBLER FRA DATABASEN			for($i=0;$i<$floorLength;$i++) {														// FOR LØKKE SOM GÅR LIKE MANGE GANGER SOM ETASJE TABELLEN HAR I LENGDE				$rad=mysql_fetch_array($result);													// LAGER VARIABEL SOM INNEHOLDER HELE ARRAYET				$floor[$i] = $rad[0];																// KOPIERER OVER ALT FRA SQL ARRAYET TIL ETASJE ARRAYET				echo "<option value='$rad[0]'>$rad[0]</option>";									// RETURNERER DEN SPESIFIKKE KOLONNEN FRA SQL ARRAYET			}			?>		</select> <label>Type: </label>		<?php 		connect(); 			// KOBLER TIL DATABASEN		roomTypeList(); 	// FUNKSJONSKALL FOR Å HENTE ROMTYPE LISTE		disconnect(); 		// KOBLER FRA DATABASEN		?>		<input class='submit' type='submit' value='Filtrer' name='regFilter'>		<input class="submit" type="submit" value="Nullstill" name="nullstill">	</form></fieldset><?php /******************************** Filtrere resultat ************************************/$regFilter = $_POST[regFilter];			// LAGRER VARIABELEN FOR SUBMITKNAPPENif ($regFilter){						// LYTTER TIL OM SUMBITKNAPPEN BLIR TRYKKET	$block = $_POST["block"];			// LAGER VARIABLER BASERT PÅ INPUT FRA SKJEMAET	$floor = $_POST["floor"];			// LAGER VARIABLER BASERT PÅ INPUT FRA SKJEMAET	$roomType = $_POST["roomType"];		// LAGER VARIABLER BASERT PÅ INPUT FRA SKJEMAET	if($block && $floor){				// HVIS DET FILTRERES PÅ BLOKK ELLER ETASJE		$filter = "WHERE Name LIKE";		$filter2 = "'" . $block .$floor . "%'";		if($roomType){					// HVIS DET I TILLEGG FILTRERES PÅ ROMTYPE			$filter3 = "AND Type LIKE '$roomType'";		}	} elseif($block && !$floor) {		$filter = "WHERE Name LIKE";		$filter2 = "'" . $block . "%'";		if($roomType){					// HVIS DET I TILLEGG FILTRERES PÅ ROMTYPE			$filter3 = "AND Type LIKE '$roomType'";		}		}	elseif(!$block && $floor) {		$filter = "WHERE Name LIKE";		$filter2 = "'_" . $floor . "%'";		if($roomType){					// HVIS DET I TILLEGG FILTRERES PÅ ROMTYPE			$filter3 = "AND Type LIKE '$roomType'";			}		}		if(!$block && !$floor){				// HVIS DET FILTRERES PÅ ROMTYPE					if($roomType){				$filter4 = "WHERE Type LIKE '$roomType'";			}		}}/********************************** Vis alle rom **************************************/connect();																			//KOBLER TIL DATABASEN$sql= "SELECT * FROM room $filter $filter2 $filter3 $filter4 ORDER BY Name ASC;";	//SQL-SPØRRING - ULIKE FILTER LEGGES TIL SQL-SPØRRINGEN VED AT VARIABLER FÅR VERDI$result = mysql_query($sql) or die ("ikke mulig å hente rom fra databasen");		//SQL-SPØRRING KJØRES OG RESULTAT LEGGES I VARIABEL ELLER FEILMELDING SKRIVES DERSOM NOE GIKK GALT$numRows = mysql_num_rows($result);													//TELLER ANTALL RADER I RESULTATETif($numRows == 0) {	echo "Dine søk ga ingen treff";} else {	echo "		<table class='standard_table'>		<thead class='standard_table_header'>			<tr>				<th></th>				<th>RomId</th>				<th>Navn</th>				<th>Type</th>				<th></th>				<th></th>				<th></th>			</tr>		</thead>		<tbody>";	for($t=1; $t<=$numRows; $t++){														//FOR LØKKE SOM GJENTAS LIKE MANGE GANGER SOM DET ER RADER I RESULTATET		$row=mysql_fetch_array($result);												//RESULTATET GJØRES TIL ARRAY OG LEGGES I EN VARIABEL		$room_id = $row[0];																//VERDI ÈN I ARRAYET LEGGES I EN VARIABEL		$room_name = $row[1];															//VERDI TO I ARRAYET LEGGES I EN VARIABEL		$room_type = $row[2];															//VERDI TRE I ARRAYET LEGGES I EN VARIABEL		echo "		<tr>		<form method='post' action='endre-rom.php' name='modRoomForm' id='modRoomForm'>		<td class='standard_table_data'><input type='hidden' value='$room_id' name='room_id' id='room_id'></td>		<td class='standard_table_data'>$room_id</td>		<td class='standard_table_data'>$room_name</td>		<td class='standard_table_data'>$room_type</td>		<td class='standard_table_data'><input type='submit' value='Endre' name='modifySubmit' id='modifySubmit'>		</form>		<form method='post' action='' name='deleteRoomForm' id='deleteRoomForm' onSubmit='return confirmDelete()'>		<td class='standard_table_data'><input type='hidden' value='$room_id' name='room_id' id='room_id'></td>		<td class='standard_table_data'><input type='submit' value='Slette' name='deleteSubmit' id='deleteSubmit'></td>		</form>		</tr>		";}	disconnect();																		//KOBLER FRA DATABASEN}?>		</tbody> 			<tfoot>			<tr>				<th></th>				<th></th>				<th></th>				<th></th>				<th></th>				<th></th>			</tr>		</tfoot>	</table><?php/********************************* Slette rom **************************************/$deleteSubmit=$_POST['deleteSubmit'];												//LAGER SLETTEKNAPPif($deleteSubmit){																	//LYTTER PÅ OM SLETTEKNAPP BLIR TRYKKET PÅ	$room_id = $_POST['room_id'];													//HENTER ROMID FRA SKJEMA		connect();																		//KOBLER TIL DATABASEN		//sql spørring - romId legges til sql setningen ved at variabel får verdi som er hentet ved POST metode		$sql = "CALL deleteRoom('$room_id');";											//SQL SPØRRINGEN MOT DATABASEN	$result = mysql_query($sql) or die ("ikke mulig å slette rom fra databasen");	//SQL-SPØRRING OG RESULTATET LEGGES I VARIABEL ELLER FEILMELDING SKRIVES DERSOM NOE GIKK GALT		disconnect();																	//KOBLER FRA DATABASEN		echo "<script> alert('Følgende RomID er nå slettet: $room_id ') </script>";		//SKRIVER UT HVILKET ROM SOM BLE SLETTET}$nullstill=$_POST['nullstill'];												//LAGER SLETTEKNAPPif($nullstill){	header("vis-rom.php");	exit;}?><?php include '../includes/footerVedlikehold.php';									//INKLUDERER FOOTER FOR VEDLIKEHOLD?>