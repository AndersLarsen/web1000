<?php/** * Vise oversikt over alle bestillinger * * PHP version 5 * * LICENSE: This source file is subject to version 3.01 of the PHP license * that is available through the world-wide-web at the following URI: * http://www.php.net/license/3_01.txt.  If you did not receive a copy of * the PHP License and are unable to obtain it through the web, please * send a note to license@php.net so we can mail you a copy immediately. * * @author		Original Author <andersborglarsen@gmail.com> * @author		Original Author <haavard@ringshaug.net> * @author		Original Author <oyvind.gautestad@gmail.com> * @author		Original Author <linda.fermann@gmail.com> * @copyright 	2013-2018 * @license		http://www.php.net/license/3_01.txt * @link		http://student.hive.no/web10007/1 * */$title = 'Vis alle bestillinger - roomEdit';			//SETTER TITTEL PÅ SIDEN I BROWSERFANEinclude '../includes/headerVedlikehold.php';			//INKLUDERER HEADEREN PÅ NETTSTEDETcheckLogin();											//SJEKKER OM BRUKER ER LOGGET INNcheckAdmin();											//SJEKKER OM EN BRUKER HAR ADMIN STATUS?><h1>Aktive bestillinger</h1><?php 	$timestamp = $_SERVER['REQUEST_TIME'];				//HENTER TIDSPUNKTET NÅ OG LEGGER I VARIABEL	$today = date('Y-m-d', $timestamp);					//ÅR, MÅNED OG DATO HENTES FRA VARIABELEN OG LEGGES I NY VARIABEL 	$time = date('H:i:s', $timestamp);					//TIME, MINUTTER OG SEKUNDER HENTES FRA VARIABELEN OG LEGGES I NY VARIABEL	connect();											//KOBLER TIL DATABASEN	$sql = "SELECT Dato,Start_Time,End_Time,Name,Type,Ref_Booking,Username			FROM Booking,Room,User			WHERE Booking.Room_Id=Room.RoomId			AND Booking.User_Ref=User.Ref_User 			AND STR_TO_DATE(CONCAT(`Dato`, ' ', `End_Time`), '%Y-%m-%d %H:%i:%s' ) >= TIMESTAMP(NOW())			ORDER BY Dato ASC,Start_Time ASC;";			//SQL-SPØRRING SOM HENTER BESTILLINGER I DAG ELLER FRAMOVER FOR ALLE BRUKERE	$result = mysql_query($sql) or die ("Ikke mulig å hente bestillinger fra databasen");	//KJØRER SQL-SPØRRINGEN OG TILORDNER RESULTATET I EN VARIABEL	$numRows= mysql_num_rows($result);					//TELLER ANTALL RADER SOM BLE FUNNET	disconnect();										//KOBLER FRA DATABASEN		if ($numRows == 0) {								//DERSOM INGEN RADER FUNNET		echo 'Det er ingen aktive bestillinger';		//SKRIVER UT MELDING OM AT DET IKKE ER NOEN BESTILLINGER		} else { 										//DERSOM RADER FUNNET SKRIVES BESTILLINGER UT I HTML-SKJEMA?>				<table class="standard_table">	<thead class="standard_table_header">		<tr>			<th>Dato</th>			<th>Fra kl.</th>			<th>Til kl.</th>			<th>RomNr.</th>			<th>Romtype</th>			<th>Ref.Nr</th>			<th>Brukernavn</th>			<th></th>			<th></th>			<th></th>			<th></th>		</tr>	</thead>	<tbody><?php 		for($t=1; $t<=$numRows;$t++){						//FOR LØKKE SOM GÅR SÅ MANGE GANGER SOM RADER SOM BLE FUNNET		$row=mysql_fetch_array($result);				//HENTER RESULTATET SOM ARRAY OG TILORDNER DET TIL EN VARIABEL		$dato=$row[0];									//FØRSTE VERDI I HVER RAD LAGRES I VARIABEL		$start_time=$row[1];							//ANDRE VERDI I HVER RAD LAGRES I VARIABEL		$end_time=$row[2];								//TREDJE VERDI I HVER RAD LAGRES I VARIABEL		$name=$row[3];									//FJERDE VERDI I HVER RAD LAGRES I VARIABEL		$type=$row[4];									//FEMTE VERDI I HVER RAD LAGRES I VARIABEL		$ref_booking=$row[5];							//SJETTE VERDI I HVER RAD LAGRES I VARIABEL		$username=$row[6];								//SYVENDE VERDI I HVER RAD LAGRES I VARIABEL					echo "		<tr>		<form class='' name='editBooking' id='editBooking' action='endre-bestilling.php' method='post'>		<td class='standard_table_data'>" . normalDate($dato) . "</td>		<td class='standard_table_data'>" . normalTime($start_time) . "</td>		<td class='standard_table_data'>" . normalTime($end_time) . "</td>		<td class='standard_table_data'>$name</td>		<td class='standard_table_data'>$type</td>		<td class='standard_table_data'>$ref_booking</td>		<td class='standard_table_data'>$username</td>		<td class='standard_table_data'><input type='hidden' value='$ref_booking' name='ref_booking' id='ref_booking'></td>		<td class='standard_table_data'><input type='hidden' value='$username' name='username' id='username'></td>		<td class='standard_table_data'><input type='submit' value='Endre' name='editBookingSubmit' id='editBookingSubmit'></td>		</form>		<form class='' name='deleteBooking' name='deleteBooking' action='' method='post' onSubmit='return confirmDelete()'>		<td class='standard_table_data'><input type='hidden' value='$ref_booking' name='ref_booking' id='ref_booking'> </td>		<td class='standard_table_data'><input type='submit' value='Slett' name='deleteBookingSubmit' id='deleteBookingSubmit'></td>		</form>		</tr>		";	}		echo '</tbody>';	echo '</table>';	echo '</form>';}/********************************* Slette booking ****************************************/	$delete = $_POST["deleteBookingSubmit"];											//LAGER SLETTE-KNAPP	if ($delete) {																		//LYTTER TIL OM SLETTEKNAPP TRYKKES PÅ		$ref_booking = $_POST['ref_booking'];											//HENTER BESTILLINGSREFERANSE FRA SKJEMA			connect();																		//KOBLER TIL DATABASEN		$sql = "DELETE FROM Booking WHERE Ref_Booking='$ref_booking';";					//SQL-KOMMANDO SOM SLETTER DEN AKTUELLE BESTILLINGEN		mysql_query($sql) or die ("Ikke mulig å slette bestilling fra databasen");		//SQL-KOMMANDO KJØRES ELLER RETURNERER FEILMELDING DERSOM NOE GALT SKJER			echo "<script>alert('Bestilling med referansenummer $ref_booking er nå slettet fra databasen')</script>";	//SKRIVER UT BEKREFTELSESMELDING OM HVILKEN BESTILLING SOM ER SLETTET I JAVASCRIPT			$self=$_SERVER['PHP_SELF'];				echo "<form method='post' action='$self' id='egetKall' name='egetKall'>				<input type='submit' value='Se oppdatert tabell' id='oppdater' name='oppdater' class='input' />				</form>";		disconnect();	}?><?php include '../includes/footerVedlikehold.php'; 			//INKLUDERER FOOTER FOR VEDLIKEHOLD?>