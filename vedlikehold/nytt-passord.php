<?php /** * ENDRE PASSORD TIL VALGT TIL BRUKER *  * * PHP version 5 * * LICENSE: This source file is subject to version 3.01 of the PHP license * that is available through the world-wide-web at the following URI: * http://www.php.net/license/3_01.txt.  If you did not receive a copy of * the PHP License and are unable to obtain it through the web, please * send a note to license@php.net so we can mail you a copy immediately. * * @author		Original Author <andersborglarsen@gmail.com> * @author		Original Author <haavard@ringshaug.net> * @author		Original Author <oyvind.gautestad@gmail.com> * @author		Original Author <linda.fermann@gmail.com> * @copyright 	2013-2018 * @license		http://www.php.net/license/3_01.txt * @link		http://student.hive.no/web10007/1 * */$title = 'Nytt Passord - roomEdit';													//SETTER TITTEL PÅ SIDEN I BROWSERFANEinclude '../includes/headerVedlikehold.php';											// INKLUDERER HEADERcheckLogin();// SJEKKER AT MAN ER LOGGET INNcheckAdmin();											//SJEKKER OM EN BRUKER HAR ADMIN STATUS?><h1>Endre passord</h1><p> Passord skal kun bestå av små eller store bokstaver (A-Z) og tall (0-9). Fra 6-12 karakterer. </p><?php /****************************** Endre Passord ****************************************/$modifySubmit=$_POST["modifySubmit"];$userId = $_POST["userId"];connect();																					// KOBLER TIL DATABASEN$sql= "CALL showByUserId('$userId');";														// SQL SPØRRINGEN$result = mysql_query($sql) or die ("ikke mulig å hente Bruker og passord fra  fra databasen");		//RETURNERER FEILMELDING HVIS SPØRRINGEN FEILER$row=mysql_fetch_array($result);															// HENTER ARY TAR DET UT I RADER$userId = $row[0];$username =$row[1];$mail =$row[2];$position_Id =$row[4];$admin=$row[5];$ref_user=$row[6];disconnect();																				// KOBLER FRA DATABASENecho "<form class='' name='updateuser' action='' method='post'><input type='hidden' name='userId' id='UserID' value='$userId' readonly /><br />	<p> Brukernavn : $username </p>	<p> Bruker Ref: $ref_user </p><label for='newPassword' class='clearfloat'> Nytt passord </label><input type='password' name='newPassword' id='newPassword' tabindex='3' pattern='.{6,}' required /><br />	<label for='newPassword2' class='clearfloat'> Nytt passord (igjen) </label><input type='password' name='newPassword2' id='newPassword2' tabindex='4' pattern='.{6,}' required /><br />	<input type='submit' value='Lagre endringer' name='regUpdate'></form>";echo ("		<form method='post' action='vis-brukere.php'>		<input type='submit' value='Avbryt' id='back' name='back'>		</form>		");																					//AVBRYTER ENDRING OG DIRIGERER TILBAKE$regUpdate = $_POST["regUpdate"];														//HENTER INN SUBMITKNAPPENif ($regUpdate){																	// LYTTER TIL SUBMITKNAPPEN	// sjekker om submitknapp er trykkket på	$userId = $_POST["userId"];									// henter brukernavn fra skjema	$newPassword = $_POST["newPassword"];		// henter nytt passord fra skjema	$newPassword2 = $_POST["newPassword2"];		// henter nytt passord (bekreft) skjema	if  ( !$newPassword || !$newPassword2 ) {										// sjekker at alle felter er fylt ut		echo "<script> alert('Alle felter må fylles ut') </script>";	} elseif ($newPassword != $newPassword2){							// sjekker om nytt passord er skrevet likt i begge felt		echo "<script> alert('Det nye passordet må skrives inn likt to ganger') </script>";		// returnerer feilmelding hvis ikke	} else {		connect();		$newPassword=mysql_real_escape_string(cryptPassword($newPassword));			// fjerner spesialtegn for å ungå missbruk av SQL databasen		// går videre hvis det er treff					// kobler til databasen		$sql="UPDATE user SET Passord='$newPassword' WHERE userId='$userId'";		// sql spøring		$result = mysql_query($sql) or die ("<script> alert('ikke mulig å hente Bruker fra  fra databasen') </script>");	// kjører spørring					disconnect();											// kobler fra databasen					echo "<script> alert(' Passordet er nå endret'); window.location = 'vis-brukere.php'; </script>";	// bekreftelse til bruker				}}		include("../includes/footerNettsted.php"); 								// inkluderer footer på side