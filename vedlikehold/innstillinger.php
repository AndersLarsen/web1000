<?php /** *KAN LEGGE TIL ROMTYPER *GIR DEG MULIGHET Å FORANDRE PÅ INSTILLINGER FOR DE FORSKJELLIGE DELENE AV SYSTEMET *GIR DEG MULIGHET Å FORANDRE INTERVALLENE I TID FOR BOOKING * *  *  * PHP version 5 * * LICENSE: This source file is subject to version 3.01 of the PHP license * that is available through the world-wide-web at the following URI: * http://www.php.net/license/3_01.txt.  If you did not receive a copy of * the PHP License and are unable to obtain it through the web, please * send a note to license@php.net so we can mail you a copy immediately. * * @author		Original Author <andersborglarsen@gmail.com> * @author		Original Author <haavard@ringshaug.net> * @author		Original Author <oyvind.gautestad@gmail.com> * @author		Original Author <linda.fermann@gmail.com> * @copyright 	2013-2018 * @license		http://www.php.net/license/3_01.txt * @link		http://student.hive.no/web10007/1 * */ $title = 'Innstillinger - roomEdit';include '../includes/headerVedlikehold.php';							// INKLUDERER HEADER checkLogin();	/**********************Legge over bestillinger til BoookingHistory*************/?><form action='' method='post' name='history' id='history'><h2>Historikk</h2><p>Trykk på knappen for å flytte bestillinger pasert i tid over i en historisk tabell. <br> Anbefales å gjøres hver dag.</p><input type='hidden' id='dato' name='dato' value='$dato'><input type='submit' value='Flytt gamle bestillnger' id=transfer name='transfer'></form><?php disconnect();																			// KOBLER FRA$transfer=$_POST['transfer'];														//STARTEN PÅ SLETT BRUKERif($transfer){	$dato = $_POST['dato'];	connect();	//sql spørring - romId legges til sql setningen ved at variabel får verdi som er hentet ved POST metode	$sql = "CALL bookingTransfer();";												// SPØRRING TIL DATABASEN	$result = mysql_query($sql) or die ("ikke mulig å flytte bestillinger fra databasen");		// RETURNER FEILMELDING HVIS SPØRRING FEILER	echo "<script> alert('Bestilingerer nå flyttet fra Booking til historikk'); window.location = 'innstillinger.php';</script>";							// ALERTBOX på at BRUKER ER SLETTET	disconnect();}?><?php /*******************ENDRE ELLER SLETTE ROMTYPER********************************/connect();?><form action="" method="post" name="new_room_type_form" onSubmit="return validateRoomType((document.getElementById('room_type').value))"><h2 class="marginTop40">Romtyper</h2><label>Legg til ny romtype:</label><input type=" text" name="room_type" id="room_type" pattern="^[A-ZÆØÅ][a-z æøå]+$" required ><input type="submit" value="Legg til" id="new_room_type_submit" name="new_room_type_submit"></form><table class="standard_table"><thead ><tr><th class="standard_table_header"></th><th class="standard_table_header" align=left>Rom Typer</th></tr></thead><tbody><br><br><?php //sql spørrring - ulike filter legges til sql setningen ved at variabler får verdi$sql= "SELECT * FROM roomtypes;";																	// VISER ALLE FRA BRUKER$result = mysql_query($sql) or die ("ikke mulig å hente rom fra databasen");				// FEILMELDING HVIS SPØRRINGEN FEILER$numRows = mysql_num_rows($result);for($t=1; $t<=$numRows; $t++){	$row=mysql_fetch_array($result);	$roomtype = $row[0];	echo "	<tr>	<form method='post' action='endre-romtype.php' name='editroomtype' id='editroomtype'>	<td class='standard_table_data'>$roomtype	<input type='hidden' value='$roomtype' name='roomtype' id='roomtype'>	</td>	<td><input type='submit' value='Endre' name='modifySubmit' id='modifySubmit'></td>	</form>	<form method='post' action='' name='deleteUser' id='deleteUser'>	<td><input type='hidden' value='$roomtype' name='roomtype' id='roomtype'></td>	<td><input type='submit' value='Slett' name='deleteSubmit' id='deleteSubmit' onSubmit='confirmDelete();'></td>	</tr>	</form>	";}	disconnect();																			// KOBLER FRA	$deleteSubmit=$_POST['deleteSubmit'];														//STARTEN PÅ SLETT BRUKER	if($deleteSubmit){	$roomtype = $_POST['roomtype'];			connect();			//sql spørring - romId legges til sql setningen ved at variabel får verdi som er hentet ved POST metode			$sql = "CALL deleteRoomtype('$roomtype');";												// SPØRRING TIL DATABASEN			$result = mysql_query($sql) or die ("ikke mulig å slette bruker fra databasen");		// RETURNER FEILMELDING HVIS SPØRRING FEILER			echo "<script> alert('Følgende Rom med navn: $roomtype er nå slettet'); window.location = 'innstillinger.php';</script>";							// ALERTBOX på at BRUKER ER SLETTET			disconnect();	}	?>		</tbody>		<tfoot>			<tr>				<th></th>				<th></th>				<th></th>				<th></th>				<th></th>				<th></th>				<th></th>				<th></th>				<th></th>			</tr>		</tfoot>	</table>		<?php/********************************** Legg til ny romtype **************************************/?>			<?php $new_room_type_submit =$_POST["new_room_type_submit"];						// HENTER INN SUBMITKNAPPEN FRA SKJEMA$room_type= ucfirst(strtolower($_POST["room_type"]));											//LAGRER ROM TYPE I VVARIABLEN FRA SKJEMAif($new_room_type_submit){	if(validateRoomType($room_type)) {										// VALIDERER		connect();		$sql="SELECT Roomtype FROM roomtypes WHERE Roomtype='$room_type';";		$result=mysql_query($sql);		$numRows=mysql_num_rows($result);		disconnect();				if ($numRows !==0) {			echo "<script> alert('$room_type finnes allerede')</script>";		} else {			connect();			$sql="INSERT INTO `web10007`.`roomtypes` (`Roomtype`) VALUES ('$room_type');";// SQL SPØRRING			$result=mysql_query($sql) or die ("ikke mulig å legge til romtype i databasen");// LAGRER SVARE PÅ SQL SPØRRING			disconnect();																	// KOBLER FRA 					echo "<script> alert('$room_type er nå lag til som romtype '); window.location = 'innstillinger.php';</script>";			//BEKREFTELE RETURNERES		}}}/********************************** Tidsintervall for bestillinger **************************************/?><h2 class="marginTop40">Tidsintervall for bestillinger</h2><?php connect();											// KOBLER TIL DATABASEN$sqlTime="SELECT DISTINCT SUBSTRING(Klokka,4,2) as Timer FROM time;"; 	// SQL SETNING$resultTime=mysql_query($sqlTime) or die ("Ikke mulig å hente tidsintervall");	// LAGRER SQL RESULTATET$numRowsTime=mysql_num_rows($resultTime);			//dersom 4->15 min (00,15,30,45), dersom 2->30 min (00,30), dersom 1->60 min (00)disconnect();										//KOBLER FRA DATABASEN						if ($numRowsTime==4) {								//DERSOM ANTALL RADER ER 4, VIL DET SI AT 00,15,30,45 BLE FUNNET SOM MINUTTER I TABELLEN	$timeInterval = 15;								//DET TILSVARER DA ET TIDSINTERVALL PÅ 15 MINUTTER} elseif ($numRowsTime==2) {						//DERSOM ANTALL RADER ER 4, VIL DET SI AT 00 OG 30 BLE FUNNET SOM MINUTTER I TABELLEN	$timeInterval = 30;								//DET TILSVARER DA ET TIDSINTERVALL PÅ 30 MINUTTER} else {											//DERSOM ANTALL RADER ER 1, VIL DET SI AT KUN 00 BLE FUNNET SOM MINUTTER I TABELLEN	$timeInterval = 60;								//DET TILSVARER DA ET TIDSINTERVALL PÅ 60 MINUTTER}echo "<p>Gjeldende tidsintervall for bestillinger er: <strong>$timeInterval minutter</strong></p>";?><form action="" method="post"><fieldset><legend for="intervall">Sett nytt tidsintervall for bestillinger</legend><p><strong>OBS:</strong> Tidsintervall skal kun endres i forbindelse med fellesferie og alle aktive bestillinger må oppdateres med start- og sluttintervall samsvarende med nytt intervall</p><select name="intervall"><option value="15">15 Min</option><option value="30">30 Min</option><option value="60">60 Min</option><input type="submit" value="Endre" id="intervallKnapp"			name="intervallKnapp" tabindex="7" /></select></fieldset></form><br><?php $intervallKnapp = $_POST["intervallKnapp"];$intervall = $_POST["intervall"];if($intervallKnapp){	if($intervall == '15') {		connect();																		//KOBLER TIL		$sql="CALL set15min();";															//SETTER INTERVALLEN TIL 15 MIN		$result=mysql_query($sql) or die ("ikke mulig å hente minutter fra databasen");		$minLength=mysql_num_rows($result);											disconnect();																	//KOBLER FRA					echo ("<script> alert('Tidsintervall er endret til hvert kvarter'); window.location = 'innstillinger.php';</script>");	// RETURNERER BEKREFTELSE	} elseif ($intervall == '30'){		connect();																		//KOBLER TIL		$sql="CALL set30min();";														// SETTER INTERVALLEN TIL 30 MIN		$result=mysql_query($sql) or die ("ikke mulig å hente minutter fra databasen");		$minLength=mysql_num_rows($result);		disconnect();																	//KOBLER FRA		echo ("<script> alert('Tidsintervall er endret til hver halvtime.'); window.location = 'innstillinger.php';</script>");	//RETURNERER BEKREFTELSE			} elseif ($intervall == '60'){															connect();																		//KOBLER TIL		$sql="CALL set60min();";														//SETTER INTERVALLEN TIL 60 MIN		$result=mysql_query($sql) or die ("ikke mulig å hente minutter fra databasen");		$minLength=mysql_num_rows($result);		disconnect();																	//KOBLER FRA				echo ("<script> alert('Tidsintervall er endret til hver hele time'); window.location = 'innstillinger.php';</script>");	//RETURNERER BEKREFTELSE	}}/********************************** Brukerrettigheter **************************************/?><h2 class="marginTop40">Brukerrettigheter</h2>	<table class="standard_table">		<thead >			<tr>				<th class="standard_table_header"></th>				<th class="standard_table_header" align=left>Id</th>				<th class="standard_table_header" align=left>Maks aktive bestillingstimer</th>				<th class="standard_table_header" align=left>Maks antall dager fram i tid</th>				<th class="standard_table_header" align=left>Brukergruppe</th>				<th class="standard_table_header"></th>				<th class="standard_table_header"></th>			</tr>		</thead>		<tbody>	<?php connect();$sql= "SELECT *	 FROM setup;";															// SQL SPØRRING$result = mysql_query($sql) or die ("ikke mulig å hente rom fra databasen");			// LAGRER RESULTAT I VARIABEL ELLER SKRIVER FEILMELDING HVIS SPØRRINGEN FEILER$numRows = mysql_num_rows($result);														//TELLER ANTALL RADER I RESULTATETfor($t=1; $t<=$numRows; $t++){															//FOR LØKKE SOM GJENTAS LIKE MANGE GANGER SOM ANTALL RADER I RESULTAT	$row=mysql_fetch_array($result);													//HENTER RESULTATET I EN ARRAY OG LEGGER I VARIABEL		$Id = $row[0];																		//VERDI ÈN I RAD LEGGES I VARIABEL	$Max_Hours = $row[1];																//VERDI TO I RAD LEGGES I VARIABEL	$PreDays = $row[2];																	//VERDI TRE I RAD LEGGES I VARIABEL	$position_Id = $row[3];																//VERDI FIRE I RAD LEGGES I VARIABEL			if($position_Id==1) {																//GIR POSISJONEN MER LESBARE NAVN		$position_Id = 'Ansatt';														//DERSOM POSISJON=1 ER DET BRUKERGRUPPE ANSATT	} elseif ($position_Id==2) {		$position_Id = 'Student';														//DERSOM POSISJON=2 ER DET BRUKERGRUPPE STUDENT	} else {		$position_Id = 'tom';	}																					//TABELLEN TAR IN DATA OG LAGER KNAPPER 																						//FOR SLETT OG ENDRE	echo "	<tr>		<form method='post' action='endre-instillinger.php' name='editUser' id='editUser'>			<td><input type='hidden' value='$Id' name='Id' id='Id'></td>			<td class='standard_table_data'>$Id</td>			<td class='standard_table_data'>$Max_Hours</td>			<td class='standard_table_data'>$PreDays</td>			<td class='standard_table_data'>$position_Id</td>			<td class='standard_table_data'></td>			<td class='standard_table_data'></td>			<td></td>			<td></td>			<td></td>			<td><input type='submit' value='Endre' name='modifySubmit' id='modifySubmit'>		</form>				</tr>	";	}	disconnect();																			//KOBLER FRA DATABASEN?>		</tbody> 			<tfoot>			<tr>				<th></th>				<th></th>				<th></th>				<th></th>				<th></th>				<th></th>			</tr>		</tfoot>	</table>	<input type='submit' value='Oppdater siden' onClick='document.location.reload(true)'>						<!-- LAGER KNAPP SOM RESETER SIDEN -->	<?php															//INKLUDERER FOOTER TIL VEDLIKEHOLD include '../includes/footerVedlikehold.php';?>	
