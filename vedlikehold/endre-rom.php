<?php /** * Endre rom i løsningen * Kan endre romnavn og romtype. * * PHP version 5 * * LICENSE: This source file is subject to version 3.01 of the PHP license * that is available through the world-wide-web at the following URI: * http://www.php.net/license/3_01.txt.  If you did not receive a copy of * the PHP License and are unable to obtain it through the web, please * send a note to license@php.net so we can mail you a copy immediately. * * @author		Original Author <andersborglarsen@gmail.com> * @author		Original Author <haavard@ringshaug.net> * @author		Original Author <oyvind.gautestad@gmail.com> * @author		Original Author <linda.fermann@gmail.com> * @copyright 	2013-2018 * @license		http://www.php.net/license/3_01.txt * @link		http://student.hive.no/web10007/1 * */$title = 'Endre rom - roomEdit';include '../includes/headerVedlikehold.php';	// INKLUDERER HEADERcheckLogin();									// SJEKKER OM BRUKEREN ER LOGGET INNcheckAdmin();											//SJEKKER OM EN BRUKER HAR ADMIN STATUS?><h1>Endre rom i løsningen</h1><?php /****************************** Endre rom ****************************************/$modifySubmit=$_POST["modifySubmit"];			// HENTER INN SUBMIT KNAPPEN FRA SKJEMAET$room_id = $_POST["room_id"];					// HENTER INN ROMID FRA SKJEMAETconnect();										// KOBLER TIL DATABASEN$sql= "SELECT *	 FROM room WHERE RoomId = '$room_id';";	// SQL SPØRRING$result = mysql_query($sql) or die ("ikke mulig å hente rom fra databasen"); // LAGRER SVARET PÅ SQL SPØRRINGEN$row=mysql_fetch_array($result); 				// HENTER UT RADENE I SQL SVARET$room_id = $row[0];								// LAGRER ROMID FRA SQL RADEN$old_room_name = $row[1];						$room_name = $row[1];						// LAGRER ROMNAVN FRA SQL RADEN$room_type = $row[2];							// LAGRER ROMTYPE FRA SQL RADENdisconnect();									// KOBLER FRA DATABASENecho "<fieldset>";echo "<p>Romnavn skal ha format [Blokk][Etasje]-[Romnummer] f.eks. slik: A2-53</p>";echo "	<legend>Endre rom: $old_room_name</legend>";echo "  <form class='' name='update_room' action='' method='post' onSubmit='return validateRoomName((document.getElementById(\"room_name\").value))'>";echo "  <input hidden='true' type='text' name='room_id' value='$room_id'>";echo "  <input hidden='true' type='text' name='old_room_name' value='$old_room_name'>";echo "	<label>Navn</label>  <input type='text' name='room_name' id='room_name' value='$room_name' pattern='[A-Z][1-9][\-][0-9]{2}[0-9A-Z]{0,1}+' required>";echo "	<label>Type</label>"; connect();																		// KOBLER TIL DATABASEN$sql = "CALL showDistinctRoomtype;";											// SQL SETNING$result = mysql_query($sql) or die ("ikke mulig å hente romtype fra databasen");// KJØRER SQL SPØRRING PÅ DB SERVER$numRows = mysql_num_rows($result);												// HENTER RESULTATET FRA SQL SPØRRINGENdisconnect();																	// KOBLER FRA DATABASEN// lager dynamisk listeboks basert på rom funnet i databasenecho ("<select name='room_type' id='room_type'>");			// STARTEN PÅ LISTEBOKSENfor($t=1; $t<=$numRows; $t++){													// FOR-LØKKE FOR Å SKRIVE UT HVERT ENKELT RESULTAT	$row=mysql_fetch_array($result);											// HENTER ARRAY FRA SQL SPØRRINGEN	echo "<option value='$row[0]' "; if($row[0] == $room_type ) { echo "selected"; } echo "> $row[0] </option> ";							// SKRIVER UT RAD FOR RAD FRA SQL ARRAYET}echo "</select>";echo "	<input type='submit' value='Endre rom' name='regUpdate'>";echo "</form>";echo "</fieldset>";echo ("		<form method='post' action='vis-rom.php'>		<input type='submit' value='Avbryt' id='back' name='back'>		</form>		");																					//AVBRYTER ENDRING OG DIRIGERER TILBAKE$regUpdate = $_POST["regUpdate"];				// HENTER INN SUMBITKNAPPEN FRA SKJEMAif ($regUpdate){								// LYTTER ETTER SOM SUBMITKNAPPEN BLIR TRYKT	$room_id = $_POST["room_id"];				// LAGRER ROMID INPUT I VARIABELEN FRA SKJEMAET	$room_name = $_POST["room_name"];			// LAGRER ROMNAVN INPUT I VARIABELEN FRA SKJEMAET	$old_room_name = $_POST["old_room_name"];			// LAGRER ROMNAVN INPUT I VARIABELEN FRA SKJEMAET	$room_type = $_POST["room_type"];			// LAGRER ROMTYPE INPUT I VARIABELEN FRA SKJEMAET	if(validateRoomName($room_name)) {			// SJEKKER OM ROMNAVN ER FYLT INN OG VALIDERER DETTE MED ET FUNKSJONSKALL													if(strcmp($old_room_name,$room_name) != 0) {						connect();							// KOBLER TIL DATABASEN			$sql="SELECT Name FROM room WHERE name='$room_name';"; // sql spøøring			$result=mysql_query($sql);						// kjører spørring			$numRows=mysql_num_rows($result);				// returnerer resultat					if($numRows !==0) {								//DERSOM DET BLE FUNNET RADER SÅ FINNES ROMNAVN ALLEREDE				echo ("<script>alert('Romnavn $room_name finnes allerede.')</script>");			} else {				connect();				$sql="UPDATE room 				SET Name='$room_name', 				Type='$room_type' 				WHERE RoomId='$room_id';";		// SQL SPØRRING				$result=mysql_query($sql) or die ("ikke mulig å oppdatere rom i databasen");	// LAGRER SVARET PÅ SQL SPØRRINGEN				print("<script> alert('Rommet er nå oppdatert!'); window.location = 'vis-rom.php'; </script>");			// BEKREFTER TIL BRUKEREN AT ROMMET ER BLITT OPPDATERT				disconnect();							// KOBLER FRA DATABASEN			}				} else {			connect();			$sql="UPDATE room SET Name='$room_name', Type='$room_type' WHERE RoomId='$room_id';";		// SQL SPØRRING			$result=mysql_query($sql) or die ("ikke mulig å oppdatere rom i databasen");	// LAGRER SVARET PÅ SQL SPØRRINGEN			print("<script> alert('Rommet er nå oppdatert!'); window.location = 'vis-rom.php'; </script>");			// BEKREFTER TIL BRUKEREN AT ROMMET ER BLITT OPPDATERT			disconnect();							// KOBLER FRA DATABASEN		}	}}include '../includes/footerVedlikehold.php';	// INKLUDERER FOOTEREN TIL SIDEN?>