<?php/** * Endre sitt eget passord * Må skrive inn gammelt passord * og skrive inn nytt passord 2 ganger *  * * PHP version 5 * * LICENSE: This source file is subject to version 3.01 of the PHP license * that is available through the world-wide-web at the following URI: * http://www.php.net/license/3_01.txt.  If you did not receive a copy of * the PHP License and are unable to obtain it through the web, please * send a note to license@php.net so we can mail you a copy immediately. * * @author		Original Author <andersborglarsen@gmail.com> * @author		Original Author <haavard@ringshaug.net> * @author		Original Author <oyvind.gautestad@gmail.com> * @author		Original Author <linda.fermann@gmail.com> * @copyright 	2013-2018 * @license		http://www.php.net/license/3_01.txt * @link		http://student.hive.no/web10007/1 * */include("../includes/headerNettsted.php");					// Inkluderer headercheckLogin();												// Sjekker om brukeren er logget inn?><?php $changePassword = $_POST['changePassword'];$userRef = $_POST['userRef']; 		echo "<h1>Endre passord</h1>";echo "<form method='post' action='' name='changeForm' id='changeForm'>	<input type='hidden' name='userRef' id='userRef' value='$userRef' />		<label for='oldPassword' class='clearfloat'> Gjeldende passord </label>	<input type='password' name='oldPassword' id='oldPassword' tabindex='1' pattern='.{6,}' autofocus required /><br />		<label for='newPassword' class='clearfloat'> Nytt passord </label>	<input type='password' name='newPassword' id='newPassword' tabindex='2' pattern='.{6,}' required  /><br />				<label for='newPassword2' class='clearfloat'> Gjenta nytt passord </label>	<input type='password' name='newPassword2' id='newPassword2' tabindex='3' pattern='.{6,}' required  /><br />				<input type='submit' value='Endre' id='changePasswordConfirm' name='changePasswordConfirm' tabindex='4' /></form>";echo ("		<form method='post' action='min-informasjon.php'>		<input type='submit' value='Avbryt' id='back' name='back'>		</form>		");																					//AVBRYTER ENDRING OG DIRIGERER TILBAKE?><?php $changePasswordConfirm = $_POST["changePasswordConfirm"];							// henter submitknapp fra skjemaif($changePasswordConfirm){															// sjekker om submitknapp er trykkket på	$userRef = mysql_real_escape_string($_POST["userRef"]);								// henter brukerref fra skjema$oldPassword = $_POST["oldPassword"];												// henter gammelt passord fra skjema $newPassword = $_POST["newPassword"];												// henter nytt passord fra skjema$newPassword2 = $_POST["newPassword2"];												// henter nytt passord (bekreft) skjema og fjerner spesialtegn for å ungå missbruk av SQL databasen			if  (!$oldPassword || !$newPassword || !$newPassword2) {										// sjekker at alle felter er fylt ut			echo "<script> alert('Alle felter må fylles ut') </script>";	} elseif  ($newPassword != $newPassword2){														// sjekker om nytt passord er skrevet likt i begge felt			echo "<script> alert('Det nye passordet må skrives inn likt to ganger') </script>";		// returnerer feilmelding hvis ikke	} else {						$oldPassword=mysql_real_escape_string(cryptPassword($oldPassword));						// fjerner spesialtegn for å ungå missbruk av SQL databasen og krypterer passord						connect();			$sql="SELECT Ref_User FROM user WHERE Ref_User='$userRef' AND Passord='$oldPassword';";	// sql spøring			$sqlResultat=mysql_query($sql) or die("ikke mulig å hente bruker fra  fra databasen");	// utfører spøring			$row=mysql_num_rows($sqlResultat);														// henter resultat			disconnect();																			// kobler fra databasen			if($row==0){																			// sjekker om det er treff på brukerref og passord i databasen				echo "<script> alert('Du har skrevet inn feil gjeldende passord') </script>"; 		// hvis ikke returneres feilmelding			} else {																				// går videre hvis det er treff				$newPassword=mysql_real_escape_string(cryptPassword($newPassword));					// fjerner spesialtegn for å ungå missbruk av SQL databasen og krypterer passord								connect();																			// kobler til databasen				$sql="UPDATE user SET Passord='$newPassword' WHERE Ref_User='$userRef';";			// sql spøring				$result = mysql_query($sql) or die ("<script> alert('ikke mulig å hente Bruker fra databasen') </script>");	// kjører spørring									disconnect();																		// kobler fra databasen									echo "<script> alert('Ditt passord er nå endret'); window.location = 'min-informasjon.php';</script>";						// bekreftelse til bruker								}					}}?><?php include("../includes/footerNettsted.php"); 								// inkluderer footer på side ?>