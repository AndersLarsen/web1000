<?php/** * Ukeplan * * * PHP version 5 * * LICENSE: This source file is subject to version 3.01 of the PHP license * that is available through the world-wide-web at the following URI: * http://www.php.net/license/3_01.txt.  If you did not receive a copy of * the PHP License and are unable to obtain it through the web, please * send a note to license@php.net so we can mail you a copy immediately. * * @author		Original Author <andersborglarsen@gmail.com> * @author		Original Author <haavard@ringshaug.net> * @author		Original Author <oyvind.gautestad@gmail.com> * @author		Original Author <linda.fermann@gmail.com> * @copyright 	2013-2018 * @license		http://www.php.net/license/3_01.txt * @link		http://student.hive.no/web10007/1 * */$title = 'Ukeplan - roomEdit';				// LAGER EN VARIABEL FOR TITTELinclude("../includes/headerNettsted.php");	// INKLUDERER HEADEREN PÅ NETTSIDEN	checkLogin();								// SJEKKER OM EN BRUKER ER INNLOGGET						?><h1>Ukeplan</h1><p>Velg ett eller flere* rom du vil se ukeplan for. Ukeplanen vises for de neste 7 dagene.</p><p>De grønne feltene indikerer ledig rom, og du kan trykke på det feltet under klokkeslettet du ønsker å bestille rommet fra.</p><small>* Anbefaler å velge maksimum 5 rom, siden lastetiden på siden kan bli lang hvis det velges flere enn dette </small><form method="post" action="" name="showBookingRoomForm" id="showBookingRoomForm"><?php echo "<label for='rom' class='clearfloat'>Rom</label>		<select name='room[]' multiple required>";					// STARTEN PÅ ROM LISTA			$userRef = $_SESSION['userRef'];				// HENTER USERREF FRA SESSION OG LEGGER I EN LOKAL VARIABEL			echo listRooms($userRef);						// FUNKSJONSKALL FOR Å LISTE UT ROM BASERT PÅ USERREFecho "</select>";											// SLUTTEN PÅ ROM LISTAecho "Dagtid <input type='radio' name='timeOfView' value='480:960'checked >	  Kveldstid <input type='radio' name='timeOfView' value='960:1200'>";echo "<input type='submit' name='submitShowBookingRoom' id='submitShowBookingRoom' value='Vis' form='showBookingRoomForm'>";echo "</form>";$submitShowBookingRoom = $_POST[submitShowBookingRoom];		// LAGER SUMBITKNAPPif ($submitShowBookingRoom) {								// SJEKKER OM SUBMITKNAPPEN BLIRTRYKKET	$rooms = $_POST['room'];								// HENTER HELE ARRAYET	//$timestamp = $_SERVER['REQUEST_TIME'];				// LAGER EN TIMESTAMP VARIABEL BASERT PÅ SERVER TIME	//$date = date('Y-m-d', $timestamp);					// LAGER START DATO	$date = date('Y-m-d');			if (!$rooms){											// SJEKKER OM ROM ARRAYET ER TOMT														// SJEKKER OM ROM IKKE ER VALGT		print ("<h2>Du må velge minimum et rom du vil se ukeplan for</h2>");	// RETURNERER FEILMELDING HVIS IKKE KRITERIET OVER ER UTFYLT (IKKE VALGT)	} else {		//tilordne start- og sluttverdi til hvilket tidsrom som bruker velger. Dag- eller kveldstid.		$timeOfView = $_POST['timeOfView'];					// HENTER INPUT FRA SKJEMAET		$timeOfView = explode(":", $timeOfView);			// EXPLODERER UT STRENGEN		$startOfView = $timeOfView[0];						// SETTER STARTOFVIEW TID		$endOfView = $timeOfView[1];						// SETTER ENDOFVIEW TID				//finner distinkte minutter i databasen og tilordne til $timeInterval		connect();											// KOBLER TIL DATABASEN		$sqlTime="CALL disTime()"; 	// SQL SETNING		$resultTime=mysql_query($sqlTime) or die ("Ikke mulig å hente tidsintervall");	// LAGRER SQL RESULTATET		$numRowsTime=mysql_num_rows($resultTime);							//dersom 4->15 min (00,15,30,45), dersom 2->30 min (00,30), dersom 1->60 min (00)		disconnect();										// KOBLER FRA DATABASEN								if ($numRowsTime==4) {								// DERSOM ANTALL RADER ER 4, VIL DET SI AT 00,15,30,45 BLE FUNNET SOM MINUTTER I TABELLEN			$timeInterval = 15;								// DET TILSVARER DA ET TIDSINTERVALL PÅ 15 MINUTTER		} elseif ($numRowsTime==2) {						// DERSOM ANTALL RADER ER 4, VIL DET SI AT 00 OG 30 BLE FUNNET SOM MINUTTER I TABELLEN			$timeInterval = 30;								// DET TILSVARER DA ET TIDSINTERVALL PÅ 30 MINUTTER		} else {											// DERSOM ANTALL RADER ER 1, VIL DET SI AT KUN 00 BLE FUNNET SOM MINUTTER I TABELLEN			$timeInterval = 60;								// DET TILSVARER DA ET TIDSINTERVALL PÅ 60 MINUTTER		}					$weekDayName=date('l');																		//SETTER UTGANGSPUNKTET FOR UKEDAGNAVN TIL DAGEN I DAG		for ($t=0;$t<=7;$t++) {																		//FOR LØKKE SOM GJENTAS TIL OG MED $T ER 7. DVS AT DEN GJENTAS FOR DAGEN I DAG OG 7 DAGER FRAM I TID						echo "<h2>" . norwegianWeekDayName($weekDayName) . " " . normalDate($date) . "</h2>";	//SKRIVER UT UKEDAGNAVN OG DATO. SE FUNKSJONSFIL FOR FORKLARING PÅ FUNKSJONSKALLENE						foreach($rooms as $room){																//FOR HVERT ROM I ARRAYET $ROOMS GJENTAS DENNE LØKKEN				showBookingsRoom( $date, $room, $timeInterval, $startOfView, $endOfView );			//FOR HVER SPESIFIKKE ROM SJEKKES DET FOR OM DET ER BOOKET			}			$date=strftime("%Y-%m-%d", strtotime("$date +1 day"));									//ØKER GJELDENDE DATO MED 1 DAG FOR HVER RUNDE I FOR LØKKEN			$weekDayName = date('l', strtotime($date));												//UKEDAGNAVN ØKES TILSVARENDE VED Å HENTE INN DATO SOM HAR ØKT MED EN DAG		}	}}?><?php include("../includes/footerNettsted.php");						// INKLUDERER FOOTEREN TIL NETTSTEDET	?>