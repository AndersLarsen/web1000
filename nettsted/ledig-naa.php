<?php/** * Viser ledige rom akkurat nå * * * * * * PHP version 5 * * LICENSE: This source file is subject to version 3.01 of the PHP license * that is available through the world-wide-web at the following URI: * http://www.php.net/license/3_01.txt.  If you did not receive a copy of * the PHP License and are unable to obtain it through the web, please * send a note to license@php.net so we can mail you a copy immediately. * * @author		Original Author <andersborglarsen@gmail.com> * @author		Original Author <haavard@ringshaug.net> * @author		Original Author <oyvind.gautestad@gmail.com> * @author		Original Author <linda.fermann@gmail.com> * @copyright 	2013-2018 * @license		http://www.php.net/license/3_01.txt * @link		http://student.hive.no/web10007/1 * */$title = 'Ledige rom akkurat nå - roomEdit';					//SETTER TITTEL PÅ SIDEN SOM HENTES AV HEADER OG PRINTES I FANE I BROWSERinclude("../includes/headerNettsted.php");						//INKLUDERER HEADER FOR NETTSTEDETcheckLogin();													//SJEKKER OM BRUKEREN ER LOGGET INN$userRef = $_SESSION['userRef'];								//SJEKKER BRUKERENS BRUKERREFERANSE OG TILORDNER I VARIABEL?><?php$findRoomNow = $_POST["findRoomNow"];							//HENTES FRA SKJEMA$timestamp = $_SERVER['REQUEST_TIME'];							//HENTER TIDSPUNKT NÅ$date = date('Y-m-d', $timestamp);								//LEGGER ÅR, MÅNED OG DATO INN I VARIABEL$time = date('H:i:s', $timestamp);								//LEGGER TIME, MINUTTER OG SEKUNDER INN I VARIABELif ($time>='20:00:00') {	echo '<h1>Beklager, men det er ikke mulig å bestille flere rom i dag</h1>';} else {	echo '<h1>Ledige rom akkurat nå</h1>';		connect();														//KOBLER TIL DATABASEN	$sql="SELECT Admin FROM user WHERE Ref_User='$userRef'; ";		//SQL-SPØRRING SOM HENTER FELTET ADMIN I BRUKERTABELLEN	$result=mysql_query($sql) or die("Ikke mulig å hente adminrettigheter fra databasen.");		//KJØRER SQL-SPØRRINGEN OG LEGGER RESULTAT I VARIABEL ELLER SKRIVER UT FEILMELDING DERSOM NOE GÅR GALT	$result = mysql_fetch_array($result);							//LAGER RESULTAT TIL ET ARRAY OG LEGGER DET I EN VARIABEL	disconnect();													//KOBLER FRA DATABASEN		if ($result[0] == 1) {											//DERSOM ADMIN ER LIK 1, ER BRUKEREN ADMINISTRATOR OG FØLGENDE KODE KJØRES		connect();													//KOBLER TIL DATABASEN		$sqlSetning="SELECT Name,Type 						 FROM room 						 ORDER BY Type ASC, Name ASC;";				//SQL-SPØRRING SOM HENTER ALLE ROM I DATABASEN		$sqlResultat=mysql_query($sqlSetning) or die ("ikke mulig å hente data fra databasen");	//KJØRER SQL-SPØRRINGEN OG LAGRER I VARIABEL ELLER SKRIVER UT FEILMELDING DERSOM NOE GIKK GALT		$numRows=mysql_num_rows($sqlResultat);						//TELLER ANTALL RADER I RESULTATET		disconnect();												//KOBLER FRA DATABASEN			for ($r=1;$r<=$numRows;$r++){								//FOR LØKKE SOM GJENTAS LIKE MANGE GANGER SOM DET VAR RADER I RESULTATET				$row=mysql_fetch_array($sqlResultat);  				//GJØR RESULTAT OM TIL ET ARRAY OG LEGGER I VARIABEL				$room = $row[0];									//TILORDNER VERDI EN I ARRAYET I EN VARIABEL				$type = $row[1];									//TILORDNER VERDI TO I ARRAYET I EN VARIABEL				isBookedNow($time,$room,$type,$date);				//KALLER PÅ EN FUNKSJON SOM SJEKKER OM ROMMET ER LEDIG. RETURNERER ROMMET OG EN BESTILLKNAPP HVIS LEDIG		}	} else {														//DERSOM IKKE ADMIN IKKE ER LIK 1 I BRUKERTABELLEN KJØRES KODEN UNDER		connect();													//KOBLER TIL DATABASEN		$sql="SELECT Position_Id 					FROM user 				WHERE Ref_User='$userRef';";						//SQL-SPØRRING SOM SJEKKER HVILKEN BRUKERGRUPPE BRUKEREN TILHØRER		$result=mysql_query($sql) or die("Ikke mulig å hente data fra databasen.");	//KJØRER SQL-SPØRRINGEN OG LAGRER RESULTATET I EN VARIABEL ELLER SKRIVER FEILMELDING DERSOM NOE GIKK GALT		disconnect();												//KOBLER FRA DATABASEN				$post=mysql_fetch_array($result);							//HENTER RESULTATET INN I ET ARRRAY OG TILORDNER I EN VARIABEL				if($post[0] == 2) { 										//DERSOM VERDI EN I ARRAYET ER LIK 2 ER BRUKEREN EN STUDENT			connect();												//KOBLER TIL DATABASEN			$sqlSetning="SELECT Name,Type 							 FROM room 							 WHERE Type='Grupperom' 							 ORDER BY Type ASC, Name ASC;";			//HENTER UT ALLE GRUPPEROM			$sqlResultat=mysql_query($sqlSetning) or die ("ikke mulig å hente data fra databasen"); //KJØRER SQL-SPØRRINGEN OG LAGRER RESULTATET I EN VARIABEL ELLER SKRIVER FEILMELDING DERSOM NOE GIKK GALT			$numRows=mysql_num_rows($sqlResultat);					//TELLER RADER I RESULTATET			disconnect();											//KOBLER FRA DATABASEN				for ($r=1;$r<=$numRows;$r++){							//FOR LØKKE SOM GJENTAS LIKE MANGE GANGER SOM DET VAR RADER I RESULTATET					$row=mysql_fetch_array($sqlResultat);  			//GJØR RESULTAT OM TIL ET ARRAY OG LEGGER I VARIABEL					$room = $row[0];								//TILORDNER VERDI EN I ARRAYET I EN VARIABEL					$type = $row[1];								//TILORDNER VERDI TO I ARRAYET I EN VARIABEL					isBookedNow($time,$room,$type,$date);			//KALLER PÅ EN FUNKSJON SOM SJEKKER OM ROMMET ER LEDIG. RETURNERER ROMMET OG EN BESTILLKNAPP HVIS LEDIG			}		} elseif($post[0] == 1) { 									//DERSOM VERDI EN I ARRAYET ER LIK 1 ER BRUKEREN EN ANSATT				connect();											//KOBLER TIL DATABASEN			$sqlSetning="SELECT Name,Type 							 FROM room 							 WHERE Type='Grupperom' OR Type='Datalab' OR Type='Møterom' 							 ORDER BY Type ASC, Name ASC;";												//HENTER UT ALLE GRUPPEROM, DATALABBER OG MØTEROM			$sqlResultat=mysql_query($sqlSetning) or die ("ikke mulig å hente data fra databasen");		//KJØRER SQL-SPØRRINGEN OG LAGRER RESULTATET I EN VARIABEL ELLER SKRIVER FEILMELDING DERSOM NOE GIKK GALT			$numRows=mysql_num_rows($sqlResultat);					//TELLER RADER I RESULTATET			disconnect();											//KOBLER FRA DATABASEN				for ($r=1;$r<=$numRows;$r++){							//FOR LØKKE SOM GJENTAS LIKE MANGE GANGER SOM DET VAR RADER I RESULTATET					$row=mysql_fetch_array($sqlResultat);  			//GJØR RESULTAT OM TIL ET ARRAY OG LEGGER I VARIABEL					$room = $row[0];								//TILORDNER VERDI EN I ARRAYET I EN VARIABEL					$type = $row[1];								//TILORDNER VERDI TO I ARRAYET I EN VARIABEL					isBookedNow($time,$room,$type,$date);			//KALLER PÅ EN FUNKSJON SOM SJEKKER OM ROMMET ER LEDIG. RETURNERER ROMMET OG EN BESTILLKNAPP HVIS LEDIG			}		}		}}?><?php include("../includes/footerNettsted.php");				//INKLUDERER FOOTER FOR NETTSTEDET?>