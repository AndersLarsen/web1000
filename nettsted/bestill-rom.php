<?php/** * kan booke et spesifikt rom på valgt tid * * * * * * PHP version 5 * * LICENSE: This source file is subject to version 3.01 of the PHP license * that is available through the world-wide-web at the following URI: * http://www.php.net/license/3_01.txt.  If you did not receive a copy of * the PHP License and are unable to obtain it through the web, please * send a note to license@php.net so we can mail you a copy immediately. * * @author		Original Author <andersborglarsen@gmail.com> * @author		Original Author <haavard@ringshaug.net> * @author		Original Author <oyvind.gautestad@gmail.com> * @author		Original Author <linda.fermann@gmail.com> * @copyright 	2013-2018 * @license		http://www.php.net/license/3_01.txt * @link		http://student.hive.no/web10007/1 * */include("../includes/headerNettsted.php");			// INKLUDERER HEADEREN TIL NETTSTEDcheckLogin();										// SJEKKER OM EN BRUKER ER LOGGET INN?><?php //input hentet fra andre skjemaer i løsningen. Dersom disse innehar verdi blir bestillingsparametre ferdig utfylt$startTimeHour=$_POST["startTimeHour"];				// VARIABEL FOR STARTTID TIME$startTimeMinute=$_POST["startTimeMinute"];			// VARIABEL FOR STARTTID MINUTTER$endTimeHour=$_POST["endTimeHour"];					// VARIABEL FOR SLUTTTID TIME$endTimeMinute=$_POST["endTimeMinute"];				// VARIABEL FOR SLUTTTID MINUTTER$date=$_POST["date"];								// VARIABEL FOR DATO$room=$_POST["room"];								// VARIABEL FOR ROM NAVN?><form method="post" action="" name="bookRoom" id="bookRoom">	<fieldset>		<legend>Reserver Rom</legend>		<p><strong>Du har valgt dato : <?php echo normalDate($date); ?></strong></p>		<input type="hidden" name="date" id="date" value="<?php echo $date; ?>" />				<label for="fraKl" class="clearfloat">Fra kl</label>		<select name="startTimeHours">		<?php 		$timer = array();																		// LAGER ET ARRAY FOR TIMER					connect();																				// KOBLER TIL DATABASE		$sql="SELECT SUBSTRING(Klokka,1,2) as Timer FROM time GROUP BY Timer HAVING COUNT(*);"; // HENTER UT TIMER FRA DATABASEN		$result=mysql_query($sql) or die ("ikke mulig å hente timer fra databasen");			// LAGRER RESULTATET FRA DATABASEN		$timerLength=mysql_num_rows($result);													// VARIABEL SOM SIER HVOR LANG TIMER ARRAYET ER		disconnect();																			// KOBLER FRA DATABASEN				for($i=0;$i<$timerLength;$i++) {														// FOR LØKKE SOM GÅR LIKE MANGE GANGER SOM TIMER TABELLEN HAR I LENGDE			$rad=mysql_fetch_array($result);													// LAGER VARIABEL SOM INNEHOLDER HELE ARRAYET			$timer[$i] = $rad[0];																// KOPIERER OVER ALT FRA SQL ARRAYET TIL TIME ARRAYET			echo "<option value='$rad[0]' "; if($rad[0] == $startTimeHour) { echo "selected"; } echo ">$rad[0]</option>";	// RETURNERER DEN SPESIFIKKE KOLONNEN FRA SQL ARRAYET, HVIS STARTTIMEHOUR HAR VERDI OG ER LIK RAD SETTES SELECTED		}		?>		</select> 				<select name="startTimeMinutes">		<?php 		$minutter = array();																	// LAGER ET MINUTTS ARRAY				connect();																				// KOBLER TIL DATABASEN		$sql="SELECT SUBSTRING(Klokka,4,2) as Minutter FROM time GROUP BY Minutter HAVING COUNT(*) > 1;";	// HENTER UT MINUTTER FRA DATABASEN		$result=mysql_query($sql) or die ("ikke mulig å hente minutter fra databasen");			// LAGRER RESULTATET FRA DATABASEN		$minLength=mysql_num_rows($result);														// LAGRER LENGDEN PÅ RESULTATET		disconnect();																			// KOBLER FRA DATABASEN				for($i=0;$i<$minLength;$i++) {															// FOR LØKKE SOM GÅR LIKE MANGE GANGER SOM MINUTTER TABELLEN HAR I LENGDE			$rad=mysql_fetch_array($result);													// LAGER VARIABEL SOM INNEHOLDER HELE ARRAYET			$minutter[$i] = $rad[0];															// KOPIERER OVER ALT FRA SQL ARRAYET TIL MINUTT ARRAYET			echo "<option value='$rad[0]' "; if($rad[0] == $startTimeMinute) { echo "selected"; } echo ">$rad[0]</option>";									// RETURNERER DEN SPESIFIKKE KOLONNEN FRA SQL ARRAYET		}		?>		</select> 				<label for="tilKl" class="clearfloat">Til kl</label> 		<select name="endTimeHours">		<?php 		for($i=0;$i<$timerLength;$i++) {														// FOR LØKKE SOM GÅR LIKE MANGE GANGER SOM TIMETABELLEN ER I LENGDE			echo "<option value='$timer[$i]' "; if($timer[$i] == $endTimeHour) { echo "selected"; } echo ">$timer[$i]</option>";								// RETURNERER DEN SPESIFIKKE KOLONNEN I TIMETABELLEN		}		?>		</select> 		<select name="endTimeMinutes">		<?php		for($i=0;$i<$minLength;$i++) {															// FOR LØKKE SOM GÅR LIKE MANGE GANGER SOM MINUTTTABELLEN ER I LENGDE			echo "<option value='$minutter[$i]' "; if($minutter[$i] == $endTimeMinute) { echo "selected"; } echo ">$minutter[$i]</option>";						// RETURNERER DEN SPESIFIKKE KOLONNEN I MINUTT-TABELLEN		}		?>		</select> 				<label for="rom" class="clearfloat">Rom</label> 		<select name="room">			<?php 			if ($room) {																		// HVIS ROM VARIABELEN ER SATT SÅ BRUK DENNE				echo ("<option value='$room'>$room</option>");									// RETURNERER ROMMET SOM ALLEREDE ER SATT			}			$userRef	=	$_SESSION['userRef'];												// HENTER USER-REF FRA SESSION OG LAGRER DETTE I EN VARIABEL			listRooms($userRef);																// KALLER PÅ FUNKSJON MED ANGITT USER-REF			?>		</select> 		<input type="submit" value="Registrer" id="regBooking"			name="regBooking" tabindex="7" />	</fieldset></form><?php $bookingKnapp = $_POST["regBooking"];														// LAGER EN BOOKINGKNAPPif($bookingKnapp) {																			// LYTTER ETTER OM BOOKINGKNAPPEN BLIR TRYKKET	$date			= 	$_POST["date"];														// HENTER INN DATO VARIABEL FRA SKJEMAET	$startTimeClean = 	$_POST["startTimeHours"].":".$_POST["startTimeMinutes"];			// HENTER INN CLEAN STARTTID FRA SKJEMAET(UTEN SEKUNDER)	$endTimeClean	=	$_POST["endTimeHours"].":".$_POST["endTimeMinutes"];				// HENTER INN CLEAN SLUTT-TID FRA SKJEMAET(UTEN SEKUNDER)	$startTime 		= 	$_POST["startTimeHours"].":".$_POST["startTimeMinutes"].":01";		// LAGER STARTTID VARIABEL MED SEKUNDER	$endTime 		= 	$_POST["endTimeHours"].":".$_POST["endTimeMinutes"].":00";			// LAGER SLUTT-TUD VARIABEL MED SEKUNDER	$room			=	$_POST["room"];														// HENTER INN ROMMET FRA SKJEMAET	$userRef		=	$_SESSION["userRef"];												// HENTER USER-REF FRA SESSION OG LAGRER DET I ANGITT VARIABEL	$bookingRef		=	createBookingRef();													// KALLER PÅ EN FUNKSJON FOR Å LAGE OG HENTE BOOKING-REF	$roomId 		= 	getRoomId($room);													// KALLER PÅ EN FUNKSJON FOR Å HENTE ROM ID	if (!$startTime||!$endTime||!$date||!roomId){							// SJEKKER OM STARTTID,SLUTT-TID,DATO, ELLERROM ER BLITT SATT		print ("<script> alert('Alle feltene  må fylles ut')</script>");						// RETURNERER FEILMELDING HVIS IKKE KRITERIET OVER ER UTFYLT	} elseif($startTimeClean == $endTimeClean){								// SJEKKER OM STARTTID OG SLUTT-TID ER LIKE		print ("<script> alert('Starttid og sluttid kan ikke være like')</script>");			// RETURNERER FEILMELDING HVIS KRITERIET OVER ER SANT	} elseif($startTimeClean > $endTimeClean){								// SJEKKER OM STARTTID ER MINDRE ELLER LIK SLUTT-TID		print ("<script> alert('Sluttid kan ikke være tidligere enn starttid')</script>");	// RETURNERER FEILMELDING HVIS KRITERIET OVER ER SANT	} elseif($endTimeClean >'20:00'){										// SJEKKER OM SLUTTID ER STØRRE ENN KL. 20:00		print ("<script> alert('Rommet kan ikke bestilles for lengre enn til 20:00.')</script>");	// RETURNERER FEILMELDING HVIS KRITERIET OVER ER SANT	} elseif(checkIfRoomIsBooked($date, $startTime, $endTime, $roomId)) {	// KALLER PÅ FUNKSJON FOR Å SJEKKE OM ET ROM ER OPPTATT		print ("<script> alert('Dette rommet er booka innenfor den tidsrammen du har satt, vennligst prøv et annet')</script>");	// RETURNERER FEILMELDING HVIS KRITERIET OVER ER SANT	} elseif(checkUserLeftHours($userRef,$startTimeClean,$endTimeClean, $changeTime)){	// KALLER PÅ FUNKSJON FOR Å SJEKKE OM EN BRUKER HAR NOK GJENVÆRENDE TIMER FOR Å BOOKE		print ("<script> alert('Din bestilling overstiger antall timer du totalt kan ha bestilling på')</script>");		// RETURNERER FEILMELDING HVIS KRITERIET OVER ER SANT	} else {		connect();															// KOBLER TIL DATABASEN		$sql="INSERT INTO booking (		User_Ref,		Start_Time,		End_Time,		Dato,		Room_Id,		Ref_booking) VALUES (		'$userRef',		'$startTime',		'$endTime',		'$date',		'$roomId',		'$bookingRef')";				$result=mysql_query($sql) or die(mysql_error());					// LAGRER SQL RESULTATET I EN VARIABEL		disconnect();														// KOBLER FRA DATABASEN				print ("<h2>Bestillingen er nå registrert den " . normalDate($date) . " og fra " . normalTime($startTime) . " til " . normalTime($endTime) . ".</h2>");	//SKRIVER UT BEKREFTELSE PÅ HVA SOM ER BLITT REGISTRERT		echo ("		<form method='post' action='index.php'>		<input type='submit' value='Tilbake til forsiden' id='back' name='back'>		</form>		");																	//KNAPP SOM DIRIGERER TIL INDEX	}}include("../includes/footerNettsted.php");							// INKLUDERER FOOTEREN TIL NETTSTEDET?>